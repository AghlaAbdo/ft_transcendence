user www-data;

events {
	worker_connections 1024;
}

http {

	include /etc/nginx/mime.types;

	# server {
    #     listen 9090 ssl;

    #     ssl_certificate     /certs/server-certs/server.crt;
    #     ssl_certificate_key /certs/server-certs/server.key;

    #     ssl_client_certificate /certs/ca/ca.crt;
    #     ssl_verify_client on;

    #     ssl_protocols TLSv1.2 TLSv1.3;

    #     location / {
    #         proxy_pass http://prometheus:9090;
    #     }
    # }

	server {
		listen 8080 ssl;
		server_name localhost;

		ssl_certificate /certs/server-certs/server.crt;
		ssl_certificate_key /certs/server-certs/server.key;
		ssl_protocols TLSv1.3;

		# location /ws/game/ {
		# 	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		# 	proxy_set_header Host $host;
		# location /ws/game/ {
		# 	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		# 	proxy_set_header Host $host;

		# 	proxy_pass http://game-service:4000;
		# 	proxy_pass http://game-service:4000;

		# 	proxy_http_version 1.1;
		# 	proxy_set_header Upgrade $http_upgrade;
		# 	proxy_set_header Connection "upgrade";
		# }

		# location /ws/chat/ {
        # proxy_pass http://chat-service:4545/socket.io/;
        
        # # WebSocket headers
        # proxy_http_version 1.1;
        # proxy_set_header Upgrade $http_upgrade;
        # proxy_set_header Connection "upgrade";
        
        # # Standard proxy headers
        # proxy_set_header Host $host;
        # proxy_set_header X-Real-IP $remote_addr;
        # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts for long-lived connections
        # proxy_read_timeout 86400;
        # proxy_send_timeout 86400;
        
        # # Buffer settings
        # proxy_buffering off;
   		# }

		location /api/auth/ {
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Host $host;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";

			proxy_pass http://user-service:5000;
		}

		location /api/users/ {
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Host $host;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";

			proxy_pass http://user-service:5000;
		}

		location /api/friends/ {
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Host $host;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";

			proxy_pass http://user-service:5000;
		}

		location /uploads/ {
			proxy_pass http://user-service:5000;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection 'upgrade';
			proxy_set_header Host $host;
			proxy_cache_bypass $http_upgrade;
		}

		# location /api/chat {
		# 	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		# 	proxy_set_header Host $host;
		# 	proxy_http_version 1.1;
		# 	proxy_set_header Upgrade $http_upgrade;
		# 	proxy_set_header Connection "upgrade";

		# 	proxy_pass http://chat-service:4545;
		# }


		# location /grafana/ {
        #     proxy_pass http://grafana:3000/;
            
        #     proxy_set_header Host $http_host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        #     proxy_set_header X-Forwarded-Host $host;
        #     proxy_set_header X-Forwarded-Port $server_port;
            
        #     proxy_connect_timeout 60s;
        #     proxy_send_timeout 60s;
        #     proxy_read_timeout 60s;
        # }

		# location /kibana {
        #     proxy_pass https://kibana:5601;
            
        #     proxy_set_header Host $http_host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        #     proxy_set_header X-Forwarded-Host $host;
        #     proxy_set_header X-Forwarded-Port $server_port;
            
        #     proxy_connect_timeout 60s;
        #     proxy_send_timeout 60s;
        #     proxy_read_timeout 60s;
        # }

		location / {
			proxy_pass http://nextjs:3000;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
			proxy_set_header Host $host;
		}

	}

}